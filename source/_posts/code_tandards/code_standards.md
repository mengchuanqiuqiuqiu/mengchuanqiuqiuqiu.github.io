---
title: 代码整洁之道总结
categories: 代码规范
tags:
  - 代码规范
  - 设计
---

本篇文章是对《代码整洁之道》的一个简单的部分总结。
如果希望对代码规范有一个比较完整的了解，强烈建议阅读《代码整洁之道》《重构》等书籍。

### 我们为什么需要整洁的代码

1. **方便理解，降低时间成本**  
   编程的核心在于准确说出我想要的，然而除了自己，还有可能会有其他人对此代码进行维护。好的代码可以有效降低理解代码的时间成本。

2. **快速定位问题**
   基于第一点，在深入了解代码行为以及结构的基础上。可以更快的定位到问题所在。

3. **提高编程速度**
   一个系统的开发速度是逐渐降低的，因为需要花更多的时间考虑如何把新的功能塞进代码库中。需要细致的考古才能明白代码究竟是如何工作。  
   然而一个高质量的代码，可以让开发人员更快的找到在哪里进行修改维护代码。  
   这样的代码是具有耐久性的，更容易添加新的功能，可以保持一个更高的开发速度。

### 有意义的命名

1. **变量名**要求是**名副其实**的，**具有意义**的并且需要其他使用者可以读出来的名称
   这是首先也是最需要强调的部分，一个好的命名应当可以答复大部分的问题：它为什么存在，做了什么事情以及应该怎么样用。  
   如果一个名称需要用注释补充，就不算是名副其实的
2. **有意义的区分**
   光是添加数字系列（a1,a2,...）是远远不够的,这样的命名纯属误导，因为他没有提供正确的信息，没有提供导向作者意图的线索。
   废话是另外一种没有意义的区分。ProduceInfo，ProduceData 虽然名称不同，但意义相同。是一些意义含混的废话。

3. **避免思维映射**
   不应当让读者在脑海中将你的名称翻译成他们熟知的名称。例如单字母的变量名 i,j,k。明确是王道.

4. **添加有意义的语境**
   很少有名称是可以自我说明的。所以我们需要用良好命名的类，函数或名称来给作者提供一个语境.
   例如 first_name,last_name,state,city，street 的变量放在一起时，很明确是构成了一个地址，但只是在某个方法中看见单个的 state，却无法推断出是地址的一部分。
   可以添加前缀来帮助读者理解变量，例如 addr_first_name,addr_state...

5. **类名和对象**应该是**名词**或**名词短语**

### 函数

1. **函数的的第一规则就是要短小**
   让函数更容易具有说明性的名称，从而增加了文档上的价值，也更加容易理解。

2. **函数应当只做一件事，并且做好这件事**
   确保函数中的语句都在同一个层级上。不同的层级让读者无法分辨哪些是细节哪些是基础概念。
   遵循自顶向下的阅读顺序，每个函数后面跟着它下一层级的函数（如果有）

3. **使用描述性的函数名称**
   不用惧怕长名称，长而具有描述性的名称比短而令人费解的名称要好。使用某种命名约定，让函数名称中的多个单词更容易被阅读。追索好名称往往导致对代码的改善重构。  
   命名方式需要保持一致。使用与模块名一脉相承的短语、名词和动词给函数命名。例如，include_setup_and_teardown_pages,include_setup_pages

4. **别重复自己**
   重复可能是代码里的一种邪恶的根源，多个重复的代码在更改时就意味着多倍的可能性。在代码编写的过程种应该保持对重复的警惕性。对重复代码进行归纳提取。

5. **如何写出只做一件事的函数**
   整洁的代码并不要求代码从出生开始便是完美的，一开始可能都是那么冗余而复杂。  
   可以先将功能完成之后，对已经完成的代码进行，分解函数、修改名称、消除重复，来重新组装出这些函数。  
   如果一开始就按照规则写函数，很难做到每一步都是符合规范的。

### 注释

主张以好的代码替代注释，即观看函数名或变量便可知道该函数的意图  
注释是非必要则不加的，以下示例的好的注释

好的注释：

- 法律信息
- 提供信息的注释
- 对意图的解释
- 阐述
- 警示
- TODO 注释
- 放大某种看起来不合理地方的重要性

值得注意的是，**注释并不能美化糟糕的代码**，带有少量注释的整洁而有表达力的代码，要比带有大量注释而复杂的代码像样得多。与其花时间编写解释代码的注释，不如花时间清洁糟糕的代码。

### 代码的坏味道

1. **神秘命名**
   命名是编程中比较重要的一件事，如果想不出一个好的名字，说明背后很可能隐藏着更深的设计问题。
   为一个名字所付出的纠结，往往能推动我们对代码进行精简。
2. **重复代码**
   如果在一个以上的地点看到相同的代码结构，设法将他们合二为一，代码会变得更好。
   一旦有重复的代码你必须加倍仔细，留意其中细微的差异。
3. **过长函数**
   函数越长越难理解，每当要以注释说明些什么的时候，我们就把需要说明的东西写进一个独立函数中。
   反观之，如果一个地方带有注释，则可以考虑是否可以将下面的代码提炼到一个新的函数中去。
4. **过长的参数列表**
   如果多个参数拥有同样的几个参数，引入类会显得尤其有意义
5. **全局数据**
   可以被修改的全局数据尤其显得可憎，如果可以保证程序启动之后不再修改，还算是相对安全。
   如果只是少量的全局数据或许无妨，但数量越多，处理难度会越高，建议封装起来。
6. **过大的类**
   如果想利用单一的类做太多事情，其内部往往会出现太多字段，一旦如此，很容易出现重复的代码。
7. **霰弹式修改**
   每当遇到某种变化时，都必须在不同的类中做出细小的修改。如果需要更改的代码分散在各处，不光很难找到它，也很容易错过某个重要点的修改。

### 格式

每个团队都会有一套规定的格式要求，包含水平垂直，缩进等格式。  
此部分不表。

### 单元测试

**单元测试是非常非常重要的事情**，这是必不可少的。

### 总结

1. 代码不光是给机器理解的，更是需要被读者理解的，这意味着更**容易被理解的代码**是至关重要的。
2. 容易被理解的代码，不光需要从名称入手，更需要从代码的**结构**中入手。
3. 明确的名称，清晰短小的函数结构是整洁代码的两个重要点。
4. 整洁的代码并非是包治百病的万灵丹，但的确可以始终良好地控制自己地代码。
5. 程序的内部设计会随着时间的推移而逐渐腐败，当我们只按照短期目的而修改代码的时候，会经常性的没有完全理解整体设计，导致代码的结构朝着失控的方向发展。而在编写代码的过程中，维护或者重构整洁的代码，有助于维护代码的自己的应有形态。
